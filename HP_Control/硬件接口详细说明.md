# 高压液压控制系统硬件接口详细说明

## 项目概述

本文档详细描述了高压液压控制系统中所有硬件接口的定义、功能和作用。该系统基于AC7840x微控制器，用于LNG高压液压系统的精确控制和监测。

## 1. 传感器接口 (ADC)

### 1.1 温度传感器

#### LNG温度传感器
- **引脚定义**: `PA2` (物理引脚48)
- **ADC通道**: `ADC1_IN0` (通道0)
- **传感器类型**: PT1000温度传感器
- **测量范围**: -80°C ~ 90°C
- **精度**: ±0.1°C
- **主要作用**: 
  - 监测LNG温度变化
  - 系统温度保护
  - 风冷器控制决策
- **配置参数**:
  ```c
  .base = PORTA,
  .pinPortIdx = 2U,
  .pullConfig = PORT_INTERNAL_PULL_NOT_ENABLED,
  .mux = PORT_PIN_DISABLED  // ADC功能
  ```

#### 油温传感器
- **引脚定义**: `PA3` (物理引脚47)
- **ADC通道**: `ADC1_IN1` (通道1)
- **传感器类型**: PT1000温度传感器
- **测量范围**: -80°C ~ 90°C
- **精度**: ±0.1°C
- **主要作用**:
  - 监测液压油温度
  - 控制风冷器启停
  - 系统过热保护
- **配置参数**:
  ```c
  .base = PORTA,
  .pinPortIdx = 3U,
  .pullConfig = PORT_INTERNAL_PULL_NOT_ENABLED,
  .mux = PORT_PIN_DISABLED  // ADC功能
  ```

### 1.2 压力传感器

#### 油压传感器
- **引脚定义**: `PD2` (物理引脚46)
- **ADC通道**: `ADC1_IN2` (通道2)
- **测量范围**: 0-20 MPa
- **精度**: ±0.1 MPa
- **主要作用**:
  - 核心控制参数监测
  - 压力控制算法输入
  - 系统安全保护
- **配置参数**:
  ```c
  .base = PORTD,
  .pinPortIdx = 2U,
  .pullConfig = PORT_INTERNAL_PULL_NOT_ENABLED,
  .mux = PORT_PIN_DISABLED  // ADC功能
  ```

#### LNG压力传感器
- **引脚定义**: `PD3` (物理引脚45)
- **ADC通道**: `ADC1_IN3` (通道3)
- **测量范围**: 0-51.1 MPa
- **精度**: ±0.1 MPa
- **主要作用**:
  - LNG压力监测
  - 系统保护阈值判断
  - 压力控制目标设定
- **配置参数**:
  ```c
  .base = PORTD,
  .pinPortIdx = 3U,
  .pullConfig = PORT_INTERNAL_PULL_NOT_ENABLED,
  .mux = PORT_PIN_DISABLED  // ADC功能
  ```

## 2. 控制输出接口

### 2.1 阀门控制接口

#### 换向阀控制
- **引脚定义**: `PB4`
- **端口**: `GPIOB`
- **控制方式**: 数字输出 (高/低电平)
- **驱动能力**: 低驱动强度
- **主要作用**:
  - 控制液压换向阀开关
  - 实现压力调节
  - 系统循环控制
- **控制逻辑**:
  - 高电平：阀门开启
  - 低电平：阀门关闭
  - 循环控制：0.3秒开启/0.1秒关闭

#### 旁通阀控制
- **引脚定义**: `PC2` (PWM0_CH2)
- **端口**: `PORTC`
- **控制方式**: PWM输出
- **PWM实例**: `PWM0`
- **PWM周期**: 10000 (可配置)
- **开度范围**: 0-50%
- **调节步长**: 0.5%
- **主要作用**:
  - 精确控制旁通阀开度
  - 系统压力微调
  - 压力稳定控制
- **控制特性**:
  - 固定开度模式：2%
  - 动态调节模式：0-50%
  - 启动优化：50%→0%

#### 风冷器控制
- **引脚定义**: `PE8`
- **端口**: `GPIOE`
- **控制方式**: 数字输出 (高/低电平)
- **主要作用**:
  - 控制风冷器启停
  - 系统温度保护
  - 过热保护控制
- **控制逻辑**:
  - 高电平：风冷器开启
  - 低电平：风冷器关闭
  - 最小运行时间：5秒
  - 冷却时间：30秒

### 2.2 系统控制接口

#### 启动开关
- **引脚定义**: `PC17`
- **端口**: `GPIOC`
- **配置**: 上拉输入
- **触发方式**: 低电平有效
- **主要作用**:
  - 系统启动/停止控制
  - 手动操作接口
  - 系统状态检测
- **配置参数**:
  ```c
  .pullConfig = PORT_INTERNAL_PULL_UP_ENABLED,
  .direction = GPIO_INPUT_DIRECTION,
  .initValue = 0U
  ```

## 3. 通信接口

### 3.1 CAN通信接口

#### CAN接收
- **引脚定义**: `PE4`
- **端口**: `PORTE`
- **功能**: CAN0_RX
- **主要作用**:
  - 接收外部控制指令
  - 系统状态查询
  - 远程控制接口

#### CAN发送
- **引脚定义**: `PE5`
- **端口**: `PORTE`
- **功能**: CAN0_TX
- **主要作用**:
  - 发送系统状态数据
  - 故障信息上报
  - 实时数据监控

#### CAN待机控制
- **引脚定义**: `PE10`
- **端口**: `PORTE`
- **功能**: CAN0_STB
- **主要作用**:
  - 控制CAN收发器待机状态
  - 降低功耗
  - 总线管理

#### CAN通信参数
- **波特率**: 500Kbps (默认)
- **位段1**: 34
- **位段2**: 11
- **同步跳转宽度**: 11
- **预分频器**: 4
- **消息周期**: 10ms
- **消息长度**: 8字节

### 3.2 调试接口

#### 调试串口
- **接口**: `UART3`
- **主要作用**:
  - 系统调试信息输出
  - 状态监控
  - 参数配置
- **输出内容**:
  - 传感器数据
  - 控制状态
  - 故障信息
  - 系统统计

## 4. 时钟和电源接口

### 4.1 时钟配置

#### 系统时钟
- **频率**: 120MHz
- **源**: 内部PLL
- **分频**: 可配置

#### 外设时钟
- **ADC时钟**: SPLLDIV2_CLK
- **CAN时钟**: CORE_CLK/2
- **PWM时钟**: CORE_CLK
- **GPIO时钟**: CORE_CLK

### 4.2 时钟使能控制
```c
CKGEN_DRV_Enable(CLK_GPIO, true);     // GPIO时钟使能
CKGEN_DRV_Enable(CLK_ADC1, true);     // ADC1时钟使能
CKGEN_DRV_Enable(CLK_PWM0, true);     // PWM0时钟使能
CKGEN_DRV_Enable(CLK_CAN0, true);     // CAN0时钟使能
```

## 5. 硬件接口功能总结表

| 接口类型 | 引脚 | 端口 | 功能 | 控制方式 | 主要作用 |
|---------|------|------|------|----------|----------|
| **传感器输入** | | | | | |
| LNG温度 | PA2 | PORTA | ADC1_IN0 | 模拟输入 | 温度监测 |
| 油温 | PA3 | PORTA | ADC1_IN1 | 模拟输入 | 温度监测 |
| 油压 | PD2 | PORTD | ADC1_IN2 | 模拟输入 | 压力控制 |
| LNG压力 | PD3 | PORTD | ADC1_IN3 | 模拟输入 | 压力保护 |
| **控制输出** | | | | | |
| 换向阀 | PB4 | GPIOB | GPIO输出 | 数字输出 | 阀门开关 |
| 旁通阀 | PC2 | PORTC | PWM0_CH2 | PWM输出 | 开度控制 |
| 风冷器 | PE8 | GPIOE | GPIO输出 | 数字输出 | 温度控制 |
| **系统控制** | | | | | |
| 启动开关 | PC17 | GPIOC | GPIO输入 | 数字输入 | 系统启停 |
| **通信接口** | | | | | |
| CAN接收 | PE4 | PORTE | CAN0_RX | 数字输入 | 数据接收 |
| CAN发送 | PE5 | PORTE | CAN0_TX | 数字输出 | 数据发送 |
| CAN待机 | PE10 | PORTE | CAN0_STB | 数字输出 | 收发器控制 |
| **调试接口** | | | | | |
| 调试串口 | UART3 | - | 串口通信 | 数字通信 | 调试监控 |

## 6. 关键性能参数

### 6.1 ADC参数
- **分辨率**: 12位 (0-4095)
- **采样频率**: 200Hz (5ms周期)
- **转换时间**: < 1μs
- **精度**: ±0.1%

### 6.2 PWM参数
- **频率**: 10kHz (可配置)
- **分辨率**: 16位
- **占空比范围**: 0-100%
- **调节精度**: 0.1%

### 6.3 CAN参数
- **波特率**: 500Kbps
- **消息周期**: 10ms
- **错误检测**: 支持
- **自动重传**: 支持

### 6.4 控制响应时间
- **快速保护**: 1ms
- **传感器更新**: 5ms
- **控制更新**: 10ms
- **状态监控**: 100ms

## 7. 安全保护机制

### 7.1 硬件保护
- **过压保护**: 油压>16MPa紧急停机
- **过温保护**: 温度>90°C系统保护
- **通信故障**: CAN超时检测
- **传感器故障**: ADC值范围检查

### 7.2 软件保护
- **数据有效性验证**: 传感器数据范围检查
- **故障诊断**: 自动故障检测和报告
- **状态监控**: 实时系统健康检查
- **紧急停机**: 多重安全保护机制

## 8. 调试和监控

### 8.1 调试功能
- **实时数据输出**: 通过UART3输出
- **状态监控**: 系统运行状态实时显示
- **参数配置**: 支持运行时参数调整
- **故障诊断**: 详细的故障信息输出

### 8.2 监控内容
- **传感器数据**: 温度、压力实时值
- **控制状态**: 阀门状态、开度值
- **系统统计**: 运行时间、换向次数
- **故障信息**: 错误代码、故障描述

## 9. 维护和校准

### 9.1 传感器校准
- **温度校准**: PT1000标定，支持偏移量调整
- **压力校准**: 线性校准，支持零点调整
- **校准存储**: 非易失性存储校准参数

### 9.2 系统维护
- **定期检查**: 传感器精度验证
- **参数调整**: 控制参数优化
- **故障排除**: 系统诊断和修复
- **软件更新**: 固件升级支持

---

**文档版本**: 1.0  
**创建日期**: 2024年  
**适用系统**: 高压液压控制系统 v6.0  
**微控制器**: AC7840x系列
